<VirtualHost *:80>
    DocumentRoot ${APACHE_DOCUMENT_ROOT}

    ErrorLog /dev/stderr
    TransferLog /dev/stdout

    Alias "/plots" "/var/data/api/stack/plots"
    <Directory "/var/data/api/stack/plots">
        Require all granted
    </Directory>

    Header onsuccess unset Access-Control-Allow-Origin
    Header always set Access-Control-Allow-Origin "*"
    # Explicitly list headers for Chrome preflight compatibility
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Allow-Methods "GET,POST,OPTIONS"
    Header always set Access-Control-Max-Age "600"

    RewriteEngine On
    # Respond to CORS preflight with empty 204 and CORS headers
    RewriteCond %{REQUEST_METHOD} =OPTIONS
    RewriteRule ^ - [R=204,L]
</VirtualHost>
